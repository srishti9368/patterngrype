trigger:
- main   # change if your branch is different

pool:
  name: linux-grype   # EXACT agent pool name

steps:
# 1. Checkout code
- checkout: self

# 2. Install .NET SDK
- task: UseDotNet@2
  displayName: "Install .NET SDK"
  inputs:
    packageType: 'sdk'
    version: '8.0.x'

# 3. Restore dependencies
- script: |
    dotnet restore
  displayName: "Restore NuGet packages"

# 4. Build C# project
- script: |
    dotnet build --configuration Release
  displayName: "Build C# project"

# 5. Run Anchore Grype scan
- script: |
    echo "Running Anchore Grype scan"
    grype dir:. --scope all-layers
  displayName: "Anchore Grype Vulnerability Scan"

# 6. (Optional) Fail pipeline on HIGH or CRITICAL
- script: |
    grype dir:. --fail-on high
  displayName: "Fail on High/Critical Vulnerabilities"